<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" href="/img/favicon/favicon.ico">
    <link rel="manifest" href="/img/favicon/site.webmanifest">
    <title>Ola Formo Kihle</title>
    <style>
      body {
        background-color: #f6f6fc;  /* Off-white page background */
        font-family: 'Arial', sans-serif;
      }
      img {
        max-width: 100%;
        max-height: 100%;
      }
      .text {
        font-size: 10px;
        /* Removed padding-left: 25px since Bootstrap grid provides spacing */
      }
      /* Center certain elements on smaller screens */

      #profile-pic{
        display:block;
        margin:0 auto;                 /* center on mobile */
        width: clamp(120px, 28vw, 200px);
        height:auto;                    /* preserve aspect ratio */
      }

      @media (min-width: 300px) {
        #profile-pic { width: 45%; } /* adjust 85% to taste */
      }
      @media (max-width: 767px) {
        #profile-pic, #tools-image {
          display: block;
          margin: 0 auto;
        }
        .contact-icons {
          text-align: center;
        }
      }
      @media (min-width: 1200px) {
        #map-section .container { width: 1300px !important; } /* tweak 1280 → the width you prefer */
      }

      /* Unify the three blocks’ look */
      .site-title { 
        margin: 16px 0 10px;
        font-size: clamp(10px, 1.9vw, 10px);
        font-weight: 600;
      }

      .main-text,
      .main-text p,
      .main-text ul,
      .footer-note {
        font-size: 12px;    /* overrides your .text=10px inside the main block */
        line-height: 1.55;
        margin-bottom: 10px;
      }

      /* Slightly larger body text on tablets/desktops */
      @media (min-width: 768px) {
        .main-text,
        .main-text p,
        .main-text ul,
        .footer-note { font-size: 10px; }
      }

      /* Center heading + blocks on phones, align with column on larger screens */
      @media (max-width: 767px) {
        .site-title, .main-text, .footer-note { text-align: center; }
      }

      
    </style>
</head>
<body>
  <div class="container">
    <!-- Title Row -->
    <div class="row">
      <div class="col-xs-12 col-sm-8 col-sm-offset-4">
        <h4 class="site-title">Ola Formo Kihle</h4>
      </div>
    </div>
    <!-- Profile Image and Intro Text Row -->
    <div class="row">
      <div class="col-xs-12 col-sm-4">
        <img 
          id="profile-pic" 
          src="img/IMG_20240505_225507kopi.jpg" 
          alt="me" 
          class="img-responsive"
          loading="lazy"
          decoding="async"
        >
      </div>
      <div class="col-xs-12 col-sm-8 main-text">
        <p class="text">Hi, thanks for stopping by!</p>
        <p class="text">I enjoy providing services within the area of scientific computing:</p>
        <ul class="text" style="list-style-type:square;">
          <li>writing scalable open-source frameworks for processing and storage of scientific data</li>
          <li>data analysis and visualization</li>
          <li>troubleshooting open-source scientific workflows</li>
          <li>and more!</li>
        </ul>
        <p class="text">Tools used in past and present work:</p>
        <p><img id="tools-image" src="img/icons_jpg_cropped_svg_compressed_resized.svg" alt="ToolsIUse" class="img-responsive"></p>
        <p class="contact-icons text">
          <a href="mailto:ola.formo.kihle@outlook.com"><img id="email" src="img/social/mail.svg" style="height:37px;width:auto;display:inline;" alt="email icon" /></a>
          <a href="tel:+4795068110"><img id="call" src="img/social/call.svg" style="height:37px;width:auto;display:inline;" alt="call icon" /></a>
          <a href="https://github.com/ofk123"><img id="github" src="img/social/github.svg" style="height:37px;width:auto;display:inline;" alt="github icon" /></a>
          <a href="https://discourse.pangeo.io/u/ofk123/summary"><img id="pangeo" src="img/social/Pangeo-Icon_BW.svg" style="height:37px;width:auto;display:inline;" alt="pangeo icon" /></a>
        </p>
      </div>
    </div>
  </div>

  

  <!-- Map Section (wrapped in a responsive grid) -->
  <section id="map-section" style="margin: 10px 0;">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 text-center">
          <div id="mapContainer" style="padding:4px; display:inline-block;">
            <iframe 
              src="mke_tiles/index.html?zoom=-0.8&amp;legend=off&amp;glow=on" 
              width="100%" 
              height="100%" 
              style="border:none;" 
              allowfullscreen 
              loading="lazy">
            </iframe>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 text-center" style="margin:0px 0;">
          <a href="mke_tiles" class="btn btn-primary btn-xs">
            Open <span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <section id="comparison-section" style="margin: 10px 0;">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 text-center">
          <p class="text" style="margin-bottom: 5px;"><strong>Render timeseries using Xpublish's Tile router (<a href="https://github.com/earth-mover/xpublish-tiles" target="_blank">xpublish-tiles</a>):</strong></p>
          <p class="text" style="margin-bottom: 5px;"><strong>Comparing Zarr datasets with/without Icechunk as a transactional storage engine </strong></p>
          <ul class="text" style="margin-bottom: 4px; text-align: left; display: inline-block; list-style-type: square;">
            <li>Test it yourself: Navigate or change timestep, and see which version completes the render first.</li>
          </ul>
          <p class="text" style="margin-bottom: 6px; color: #555; font-style: italic;">Both datasets are equally chunked (1 chunk per timestep) and stored on GCS. The Icechunk version caches data server-side, so repeated playbacks load faster.</p>
          <div id="comparisonContainer" style="display: flex; height: 400px; border: 1px solid #ccc;">
            <iframe 
              id="left-map"
              src="deltapres_timeseries/index.html" 
              style="flex: 1; border: none; border-right: 1px solid #ccc;"
              loading="lazy">
            </iframe>
            <iframe 
              id="right-map"
              src="deltapres_timeseries_icechunk/index.html" 
              style="flex: 1; border: none;"
              loading="lazy">
            </iframe>
          </div>
          <p class="text" style="margin-top: 4px; color: #666;">Left: Zarr | Right: Icechunk — views are synced</p>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 text-center" style="margin:4px 0;">
          <a href="comparison_icechunk.html" class="btn btn-primary btn-xs">
            Comparison <span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Sync the two comparison maps
    const leftFrame = document.getElementById('left-map');
    const rightFrame = document.getElementById('right-map');
    let mapsReady = 0;

    function setupSync() {
      const leftWin = leftFrame.contentWindow;
      const rightWin = rightFrame.contentWindow;
      const leftDoc = leftFrame.contentDocument;
      const rightDoc = rightFrame.contentDocument;
      const leftMap = leftWin.map;
      const rightMap = rightWin.map;
      
      if (!leftMap || !rightMap) {
        console.log('Maps not found, retrying...');
        setTimeout(setupSync, 500);
        return;
      }

      // --- 1. Hide panel in right iframe
      const rightPanel = rightDoc.querySelector('.panel');
      if (rightPanel) {
        rightPanel.style.display = 'none';
      }

      // --- 2. Sync map view (pan/zoom/rotate)
      let syncing = false;
      function syncView(target, source) {
        if (syncing) return;
        syncing = true;
        target.jumpTo({
          center: source.getCenter(),
          zoom: source.getZoom(),
          bearing: source.getBearing(),
          pitch: source.getPitch()
        });
        syncing = false;
      }

      leftMap.on('move', () => syncView(rightMap, leftMap));
      rightMap.on('move', () => syncView(leftMap, rightMap));

      // --- 3. Get control elements
      const leftSlider = leftDoc.getElementById('slider');
      const rightSlider = rightDoc.getElementById('slider');
      const leftPlayPause = leftDoc.getElementById('playPause');
      const rightPlayPause = rightDoc.getElementById('playPause');
      const leftBack = leftDoc.getElementById('back');
      const rightBack = rightDoc.getElementById('back');
      const leftNext = leftDoc.getElementById('next');
      const rightNext = rightDoc.getElementById('next');

      // --- 4. Sync slider manual input
      if (leftSlider && rightSlider) {
        leftSlider.addEventListener('input', () => {
          rightSlider.value = leftSlider.value;
          rightSlider.dispatchEvent(new Event('input', { bubbles: true }));
        });
        
        leftSlider.addEventListener('change', () => {
          rightSlider.dispatchEvent(new Event('change', { bubbles: true }));
        });
      }

      // --- 5. Sync button clicks
      if (leftPlayPause && rightPlayPause) {
        leftPlayPause.addEventListener('click', () => {
          rightPlayPause.click();
        });
      }

      if (leftBack && rightBack) {
        leftBack.addEventListener('click', () => {
          rightBack.click();
        });
      }

      if (leftNext && rightNext) {
        leftNext.addEventListener('click', () => {
          rightNext.click();
        });
      }

      // --- 6. Animation-driven changes poll
      let lastSliderValue = leftSlider.value;
      setInterval(() => {
        if (leftSlider.value !== lastSliderValue) {
          lastSliderValue = leftSlider.value;
          if (rightSlider.value !== leftSlider.value) {
            rightWin.eval(`
              const monthIndex = ${leftSlider.value};
              currentMonth = monthIndex;
              map.getSource('data').setTiles([getTileUrl(monthIndex)]);
              document.getElementById('slider').value = monthIndex;
              document.getElementById('legend-date').textContent = 'Date: ' + getDateLabel(monthIndex);
            `);
          }
        }
      }, 100);

      console.log('Comparison maps and controls synced!');
    }

    [leftFrame, rightFrame].forEach(f => {
      f.addEventListener('load', () => {
        mapsReady++;
        if (mapsReady === 2) setTimeout(setupSync, 1500);
      });
    });
  </script>

  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-8 col-sm-offset-4">
        <p class="footer-note">Norwegian Org.nr.: 934 254 287</p>
      </div>
    </div>
  </div>
</body>
</html>
